# π“ λΈ”λ΅ μ•”νΈ λ¨λ“ (Block Cipher Mode of Operation)

## π“‘ λ©μ°¨
1. λΈ”λ΅ μ•”νΈ μ‹μ¤ν… μ΄μ λ¨λ“ κ°μ”
2. ECB (Electronic Code Book)
3. CBC (Cipher Block Chaining)
4. CFB (Cipher Feedback)
5. OFB (Output Feedback)
6. CTR (Counter)
7. ν¨λ”© (Padding)
8. μ°Έκ³  λ¬Έν—

## λΈ”λ΅ μ•”νΈ μ‹μ¤ν… μ΄μ λ¨λ“ κ°μ”
λΈ”λ΅ μ•”νΈ μ‹μ¤ν…μ€ ν•λ‚μ κ³ μ • ν¬κΈ° λΈ”λ΅μ— λ€ν•΄ λ™μ‘ν•©λ‹λ‹¤. μλ¥Ό λ“¤μ–΄, DESλ” 64λΉ„νΈ λΈ”λ΅μ„, AESλ” 128λΉ„νΈ λΈ”λ΅μ„ μ‚¬μ©ν•©λ‹λ‹¤. κ·Έλ¬λ‚ μ‹¤μ  ν‰λ¬Έ κΈΈμ΄λ” κ°€λ³€μ μ΄λ―€λ΅, λ€λ¶€λ¶„ λΈ”λ΅ ν¬κΈ°λ¥Ό μ΄κ³Όν•λ” λ°μ΄ν„°λ¥Ό μ•”νΈν™”, λ³µνΈν™”ν•  ν•„μ”κ°€ μμµλ‹λ‹¤. μ„μ κΈΈμ΄ ν‰λ¬Έμ— λ€ν•΄ λΈ”λ΅ μ•”νΈ μ‹μ¤ν…μ„ λ°λ³µ μ μ©ν•λ” λ°©λ²•μ΄ ν•„μ”ν•λ©°, μ΄λ¥Ό μ„ν•΄ λΈ”λ΅ μ•”νΈ μ‹μ¤ν… μ΄μ λ¨λ“(Block cipher mode of operation)κ°€ μ‚¬μ©λ©λ‹λ‹¤.

- **μ£Όμ” μ΄μ λ¨λ“**:
  - ECB (Electronic Code Book)
  - CBC (Cipher Block Chaining)
  - CFB (Cipher Feedback)
  - OFB (Output Feedback)
  - CTR (Counter)

## ECB (Electronic Code Book)
### π“ κ°μ”
ECB λ¨λ“λ” κ°€μ¥ λ‹¨μν• λΈ”λ΅ μ•”νΈ μ΄μ λ¨λ“μ…λ‹λ‹¤. κ° λΈ”λ΅μ΄ λ…λ¦½μ μΌλ΅ μ•”νΈν™”λκΈ° λ•λ¬Έμ— λ™μΌν• ν‰λ¬Έ λΈ”λ΅μ€ ν•­μƒ λ™μΌν• μ•”νΈλ¬Έ λΈ”λ΅μΌλ΅ μ•”νΈν™”λ©λ‹λ‹¤.

- **μ•”νΈν™”**: λΈ”λ΅ ν¬κΈ° n λΉ„νΈλ³΄λ‹¤ ν° ν‰λ¬Έ λ©”μ‹μ§€λ” n λΉ„νΈ λ‹¨μ„μ ν‰λ¬Έ λΈ”λ΅μΌλ΅ λ¶„ν• λμ–΄ κ°κ° μ•”νΈν™”λ©λ‹λ‹¤.
- **λ³µνΈν™”**: κ° μ•”νΈλ¬Έ λΈ”λ΅μ€ λ…λ¦½μ μΌλ΅ λ³µνΈν™”λμ–΄ ν‰λ¬Έ λΈ”λ΅μ΄ μƒμ„±λ©λ‹λ‹¤.
- **ν¨λ”©**: λ§μ§€λ§‰ ν‰λ¬Έ λΈ”λ΅μ΄ λΈ”λ΅ ν¬κΈ°λ³΄λ‹¤ μ‘μ€ κ²½μ° ν¨λ”©μ΄ μ μ©λ©λ‹λ‹¤.
- **μ¤λ¥ μ „ν**: μ „μ†΅ μ¤‘ νΉμ • μ•”νΈλ¬Έ λΈ”λ΅μ λ‹¨μΌ λΉ„νΈ μ¤λ¥ λ°μƒ μ‹ ν•΄λ‹Ή λΈ”λ΅μ—λ§ μν–¥μ΄ μμΌλ©°, λ‹¤λ¥Έ λΈ”λ΅λ“¤λ΅μ μ¤λ¥ μ „νλ” μ—†μµλ‹λ‹¤.
- **λ³‘λ ¬ μ²λ¦¬**: λΈ”λ΅ κ°„ λ…λ¦½μ„±μ΄ μμΌλ―€λ΅ μ•”νΈν™” λ° λ³µνΈν™” μ‹ λ³‘λ ¬ μ²λ¦¬κ°€ κ°€λ¥ν•©λ‹λ‹¤.
- **λ‹¨μ **: λ™μΌν• ν‰λ¬Έ λΈ”λ΅μ€ λ™μΌν• μ•”νΈλ¬Έ λΈ”λ΅μΌλ΅ μƒμ„±λμ–΄ ν‰λ¬Έμ ν†µκ³„μ  μ •λ³΄κ°€ κ³µκ²©μμ—κ² λ…Έμ¶λ  μ μμΌλ©°, μ•”νΈλ¬Έ λΈ”λ΅μ μ‚­μ , μμ„ λ³€κ²½ λ“±μ κ³µκ²©μ΄ κ°€λ¥ν•©λ‹λ‹¤.

### π“ μμ‹
ν‰λ¬Έ: P1 P2 P3 P4  
μ•”νΈλ¬Έ: C1 C2 C3 C4  

μ•”νΈν™”: C1 = E(P1), C2 = E(P2), ...  
λ³µνΈν™”: P1 = D(C1), P2 = D(C2), ...  

## CBC (Cipher Block Chaining)
### π“ κ°μ”
CBC λ¨λ“λ” κ° ν‰λ¬Έ λΈ”λ΅μ„ μ§μ „ μ•”νΈλ¬Έ λΈ”λ΅κ³Ό XORν• κ²°κ³Όμ— λ€ν•΄ λΈ”λ΅ μ•”νΈν™”λ¥Ό μ μ©ν•©λ‹λ‹¤. μµμ΄ ν‰λ¬Έ λΈ”λ΅μ κ²½μ° IV(Initialization Vector)κ°€ μ§μ „ μ•”νΈλ¬Έ λΈ”λ΅ λ€μ‹  μ‚¬μ©λ©λ‹λ‹¤.

- **μ•”νΈν™”**: P_i XOR C_{i-1}λ¥Ό μ•”νΈν™”ν•μ—¬ C_iλ¥Ό μƒμ„±ν•©λ‹λ‹¤. C_0μ€ IVλ΅ μ„¤μ •ν•©λ‹λ‹¤.
- **λ³µνΈν™”**: C_iλ¥Ό λ³µνΈν™”ν• κ²°κ³Όλ¥Ό C_{i-1}κ³Ό XORν•μ—¬ P_iλ¥Ό μƒμ„±ν•©λ‹λ‹¤.
- **μ¤λ¥ μ „ν**: μ „μ†΅ μ¤‘ νΉμ • μ•”νΈλ¬Έ λΈ”λ΅ λ‚΄ λ‹¨μΌ λΉ„νΈ μ¤λ¥ λ°μƒ μ‹, μμ‹  μΈ΅ λ³µνΈν™”λ¥Ό ν†µν•΄ μ–»μ–΄μ§€λ” λ€μ‘ν•λ” ν‰λ¬Έκ³Ό μ§ν›„ ν‰λ¬Έμ— μ¤λ¥κ°€ λ°μƒν•λ©°, μ΄ν›„ ν‰λ¬Έ λΈ”λ΅μ—λ” μ¤λ¥ μ „νκ°€ μ—†μµλ‹λ‹¤.
- **λ³‘λ ¬ μ²λ¦¬**: μ•”νΈν™” μ‹ λ³‘λ ¬ μ²λ¦¬ λ¶κ°€, λ³µνΈν™” μ‹ μ•”νΈλ¬Έ λΈ”λ΅λ“¤μ΄ μ¤€λΉ„λμ–΄ μμΌλ©΄ λ³‘λ ¬ μ²λ¦¬ κ°€λ¥.
- **νΉμ§•**: λ™μΌν• λ‚΄μ© λΈ”λ΅λ“¤λ„ μ„λ΅ λ‹¤λ¥Έ μ•”νΈλ¬Έ λΈ”λ΅λ“¤λ΅ λ³€ν™λ©λ‹λ‹¤.

### π“ μμ‹
ν‰λ¬Έ: P1 P2 P3 P4  
μ•”νΈλ¬Έ: C1 C2 C3 C4  

μ•”νΈν™”: C1 = E(P1 β• IV), C2 = E(P2 β• C1), ...  
λ³µνΈν™”: P1 = D(C1) β• IV, P2 = D(C2) β• C1, ...  

## CFB (Cipher Feedback)
### π“ κ°μ”
CFB λ¨λ“λ” λΈ”λ΅ μ•”νΈ μ‹μ¤ν…μ μ „μ†΅ λ‹¨μ„λ¥Ό μ μ—°ν•κ² μ„¤μ •ν•  μ μμΌλ©°, ν‰λ¬Έ λ©”μ‹μ§€λ” μ„Έκ·Έλ¨ΌνΈλ΅ λ¶„ν• λ©λ‹λ‹¤. κ° μ„Έκ·Έλ¨ΌνΈλ” λΈ”λ΅ μ•”νΈ μ‹μ¤ν…μ μ¶λ ¥κ³Ό XOR μ—°μ‚°μ„ ν†µν•΄ μ•”νΈν™”λ©λ‹λ‹¤.

- **μ „μ†΅ λ‹¨μ„**: CFB λ¨λ“μ μ „μ†΅ λ‹¨μ„ s λΉ„νΈλ” λΈ”λ΅ ν¬κΈ° n λ³΄λ‹¤ μ‘κ² μ„¤μ •ν•  μ μμµλ‹λ‹¤.
- **μ•”νΈν™”**: μ§μ „ μ•”νΈλ¬Έ λΈ”λ΅μ„ λΈ”λ΅ μ•”νΈν™”ν•μ—¬ μƒμ„±λ μ¶λ ¥μ μµμƒμ„ s λΉ„νΈμ™€ ν‰λ¬Έ μ„Έκ·Έλ¨ΌνΈλ¥Ό XORν•μ—¬ μ•”νΈλ¬Έ μ„Έκ·Έλ¨ΌνΈλ¥Ό μƒμ„±ν•©λ‹λ‹¤.
- **λ³µνΈν™”**: μ§μ „ μ•”νΈλ¬Έ λΈ”λ΅μ„ λΈ”λ΅ μ•”νΈν™”ν•μ—¬ μƒμ„±λ μ¶λ ¥μ μµμƒμ„ s λΉ„νΈμ™€ μ•”νΈλ¬Έ μ„Έκ·Έλ¨ΌνΈλ¥Ό XORν•μ—¬ ν‰λ¬Έ μ„Έκ·Έλ¨ΌνΈλ¥Ό μƒμ„±ν•©λ‹λ‹¤.
- **ν¨λ”© λ¶ν•„μ”**: ν‰λ¬Έ μ„Έκ·Έλ¨ΌνΈ ν¬κΈ° sκ°€ μ›ν•λ” λ°μ΄ν„° λ‹¨μ„(μ: 8 bits)λ΅ κ³ μ • μ„¤μ •λ κ²½μ° ν¨λ”©μ΄ ν•„μ” μ—†μµλ‹λ‹¤.
- **μ¤λ¥ μ „ν**: μ „μ†΅ μ¤‘ νΉμ • μ•”νΈλ¬Έ μ„Έκ·Έλ¨ΌνΈ λ‚΄ λ‹¨μΌ λΉ„νΈ μ¤λ¥κ°€ λ°μƒν• κ²½μ°, λ³µνΈν™”λ ν‰λ¬Έ μ„Έκ·Έλ¨ΌνΈ λ‚΄μ—μ„λ„ λ™μΌ μ„μΉμ λ‹¨μΌ λΉ„νΈ μ¤λ¥κ°€ λ°μƒν•λ©°, μ΄ν›„ λ³µνΈν™”λλ” ν‰λ¬Έμ—λ„ μν–¥μ„ λ―ΈμΉ©λ‹λ‹¤.
- **νΉμ§•**: μ•”νΈν™” λ° λ³µνΈν™”λ¥Ό μ„ν•΄ λΈ”λ΅ μ•”νΈ μ‹μ¤ν…μ μ•”νΈν™” λ¨λ“λ§ μ‚¬μ©λ©λ‹λ‹¤.

### π“ μμ‹
ν‰λ¬Έ: P1 P2 P3 P4  
μ•”νΈλ¬Έ: C1 C2 C3 C4  

μ•”νΈν™”: C1 = P1 β• E(IV), C2 = P2 β• E(C1), ...  
λ³µνΈν™”: P1 = C1 β• E(IV), P2 = C2 β• E(C1), ...  

## OFB (Output Feedback)
### π“ κ°μ”
OFB λ¨λ“λ” λΈ”λ΅ μ•”νΈ μ‹μ¤ν…μ μ¶λ ¥μ„ λ‹¤μ λΈ”λ΅μ μ…λ ¥μΌλ΅ μ‚¬μ©ν•λ” λ°©μ‹μ…λ‹λ‹¤. μ•”νΈν™”μ™€ λ³µνΈν™” κ³Όμ •μ—μ„ λ™μΌν• μ—°μ‚°μ΄ μ‚¬μ©λ©λ‹λ‹¤.

- **μ•”νΈν™”**: μ§μ „ μ¶λ ¥μ„ λΈ”λ΅ μ•”νΈν™”ν• κ²°κ³Όμ™€ ν‰λ¬Έ λΈ”λ΅μ„ XORν•μ—¬ μ•”νΈλ¬Έ λΈ”λ΅μ„ μƒμ„±ν•©λ‹λ‹¤. μµμ΄ μ…λ ¥μ€ IV κ°’μ„ μ‚¬μ©ν•©λ‹λ‹¤.
- **λ³µνΈν™”**: μ§μ „ μ¶λ ¥μ„ λΈ”λ΅ μ•”νΈν™”ν• κ²°κ³Όμ™€ μ•”νΈλ¬Έ λΈ”λ΅μ„ XORν•μ—¬ ν‰λ¬Έ λΈ”λ΅μ„ μƒμ„±ν•©λ‹λ‹¤.
- **ν¨λ”© λ¶ν•„μ”**: μ•”νΈν™” λΈ”λ΅ ν¬κΈ°κ°€ n λΉ„νΈμ΄κ³ , λ§μ§€λ§‰ ν‰λ¬Έ λΈ”λ΅μ΄ m λΉ„νΈμΈ κ²½μ°, μ•”νΈν™” μ¶λ ¥μ μµμƒμ„ m λΉ„νΈλ“¤λ§ μ·¨ν•μ—¬ λ§μ§€λ§‰ ν‰λ¬Έ λΈ”λ΅κ³Ό XOR μν–‰.
- **μ¤λ¥ μ „ν**: μ „μ†΅ μ¤‘ μ•”νΈλ¬Έ λΈ”λ΅ λ‚΄ λ‹¨μΌ λΉ„νΈ μ¤λ¥ λ°μƒ μ‹, λ³µνΈν™”λ ν‰λ¬Έ λΈ”λ΅ λ‚΄ λ™μΌ μ„μΉ λΉ„νΈμ—λ§ μν–¥μ„ λ―ΈμΉλ©° μ΄ν›„ ν‰λ¬Έ λΈ”λ΅μ—λ” μν–¥ μ—†μ.
- **νΉμ§•**: μ•”νΈν™” λ° λ³µνΈν™”λ¥Ό μ„ν•΄ λΈ”λ΅ μ•”νΈ μ‹μ¤ν…μ μ•”νΈν™” λ¨λ“λ§ μ‚¬μ©λ©λ‹λ‹¤.

### π“ μμ‹
ν‰λ¬Έ: P1 P2 P3 P4  
μ•”νΈλ¬Έ: C1 C2 C3 C4  

μ•”νΈν™”: C1 = P1 β• E(IV), C2 = P2 β• E(O1), ...  
λ³µνΈν™”: P1 = C1 β• E(IV), P2 = C2 β• E(O1), ...  

## CTR (Counter)
### π“ κ°μ”
CTR λ¨λ“λ” μΉ΄μ΄ν„° κ°’μ„ λΈ”λ΅ μ•”νΈν™”ν•μ—¬ μ•”νΈλ¬Έμ„ μƒμ„±ν•©λ‹λ‹¤. κ° λΈ”λ΅λ§λ‹¤ μΉ΄μ΄ν„° κ°’μ΄ 1μ”© μ¦κ°€ν•©λ‹λ‹¤.

- **μ•”νΈν™”**: μΉ΄μ΄ν„°λ¥Ό λΈ”λ΅ μ•”νΈν™”ν• κ²°κ³Όμ™€ ν‰λ¬Έ λΈ”λ΅μ„ XORν•μ—¬ μ•”νΈλ¬Έ λΈ”λ΅μ„ μƒμ„±ν•©λ‹λ‹¤.
- **λ³µνΈν™”**: μΉ΄μ΄ν„°λ¥Ό λΈ”λ΅ μ•”νΈν™”ν• κ²°κ³Όμ™€ μ•”νΈλ¬Έ λΈ”λ΅μ„ XORν•μ—¬ ν‰λ¬Έ λΈ”λ΅μ„ μƒμ„±ν•©λ‹λ‹¤.
- **μΉ΄μ΄ν„°**: μµμ΄ μ΄κΈ°ν™”λ κ°’μ΄ μ‚¬μ©λλ©°, λ‹¤μ λΈ”λ΅ μ²λ¦¬ μ‹ κ·Έ κ°’μ„ 1λ§νΌ μ¦κ°€μ‹ν‚µλ‹λ‹¤.
- **ν¨λ”© λ¶ν•„μ”**: μ•”νΈν™” λΈ”λ΅ ν¬κΈ°κ°€ \(n\) λΉ„νΈμ΄κ³ , λ§μ§€λ§‰ ν‰λ¬Έ λΈ”λ΅μ΄ \(m\) λΉ„νΈμΈ κ²½μ°, μΉ΄μ΄ν„°λ¥Ό μ•”νΈν™”ν• κ²°κ³Όμ μµμƒμ„ \(m\) λΉ„νΈλ“¤λ§ μ·¨ν•μ—¬ λ§μ§€λ§‰ ν‰λ¬Έ λΈ”λ΅κ³Ό XOR μν–‰.
- **μ¤λ¥ μ „ν**: μ „μ†΅ μ¤‘ μ•”νΈλ¬Έ λΈ”λ΅ λ‚΄ λ‹¨μΌ λΉ„νΈ μ¤λ¥ λ°μƒ μ‹, λ³µνΈν™”λ ν‰λ¬Έ λΈ”λ΅ λ‚΄ λ™μΌ μ„μΉ λΉ„νΈμ—λ§ μν–¥μ„ λ―ΈμΉ©λ‹λ‹¤.
- **νΉμ§•**: μ•”νΈν™” λ° λ³µνΈν™”λ¥Ό μ„ν•΄ λΈ”λ΅ μ•”νΈ μ‹μ¤ν…μ μ•”νΈν™” λ¨λ“λ§ μ‚¬μ©λ©λ‹λ‹¤.

### π“ μμ‹
ν‰λ¬Έ: P1 P2 P3 P4  
μ•”νΈλ¬Έ: C1 C2 C3 C4  

μ•”νΈν™”: C1 = P1 β• E(CTR1), C2 = P2 β• E(CTR2), ...  
λ³µνΈν™”: P1 = C1 β• E(CTR1), P2 = C2 β• E(CTR2), ...  

## ν¨λ”© (Padding)
ν¨λ”©μ€ λΈ”λ΅ ν¬κΈ°λ¥Ό λ§μ¶”κΈ° μ„ν•΄ ν‰λ¬Έμ— μ¶”κ°€λλ” λ°μ΄ν„°μ…λ‹λ‹¤. λΈ”λ΅ μ•”νΈν™”μ—μ„ λ§μ§€λ§‰ λΈ”λ΅μ΄ λΈ”λ΅ ν¬κΈ°λ³΄λ‹¤ μ‘μ„ λ• μ‚¬μ©λ©λ‹λ‹¤.

### π—ƒοΈ PKCS#7 ν¨λ”©
PKCS#7 ν¨λ”©μ€ λΈ”λ΅ ν¬κΈ° \(K\) λ°”μ΄νΈμ— λ§μ¶”κΈ° μ„ν•΄, λ©”μ‹μ§€ ν¬κΈ° \(L\) λ°”μ΄νΈμ— λ€ν•΄ μ¶”κ°€λλ” λ°”μ΄νΈμ μλ¥Ό μ§€μ •ν•©λ‹λ‹¤.
- \(L \mod K = K-1\)μ΄λ©΄ 1μ λ°”μ΄νΈ ν‘ν„ 1κ°λ¥Ό λ©”μ‹μ§€ λμ— μ¶”κ°€.
- \(L \mod K = K-2\)μ΄λ©΄ 2μ λ°”μ΄νΈ ν‘ν„ 2κ°λ¥Ό λ©”μ‹μ§€ λμ— μ¶”κ°€.
- ...
- \(L \mod K = 0\)μ΄λ©΄ \(K\)μ λ°”μ΄νΈ ν‘ν„ \(K\)κ°λ¥Ό λ©”μ‹μ§€ λμ— μ¶”κ°€.

### π“ μμ‹
- λΈ”λ΅ ν¬κΈ° 8 λ°”μ΄νΈ, λ©”μ‹μ§€ M=AABBCC β†’ ν¨λ”© ν›„ β†’ M=AABBCC0505050505
- λΈ”λ΅ ν¬κΈ° 8 λ°”μ΄νΈ, λ©”μ‹μ§€ M=1122334455667788 β†’ ν¨λ”© ν›„ β†’ M=11223344556677880808080808080808

### π—ƒοΈ λΉ„νΈ ν¨λ”©
λ©”μ‹μ§€ λμ— λΉ„νΈ 1μ„ λ¶€μ°©ν• ν›„ λΈ”λ΅ ν¬κΈ°μ λ°°μκ°€ λ  λ•κΉμ§€ λΉ„νΈ 0μ„ μ¶”κ°€ν•©λ‹λ‹¤.
- λΈ”λ΅ ν¬κΈ° 8 λ°”μ΄νΈ, λ©”μ‹μ§€ M=AABBCC β†’ ν¨λ”© ν›„ β†’ M=AABBCC8000000000
- λΈ”λ΅ ν¬κΈ° 8 λ°”μ΄νΈ, λ©”μ‹μ§€ M=1122334455667788 β†’ ν¨λ”© ν›„ β†’ M=11223344556677888000000000000000

## π“ μ°Έκ³  λ¬Έν—
- [NIST Special Publication 800-38a](https://nvlpubs.nist.gov/nistpubs/Legacy/SP/nistspecialpublication800-38a.pdf)
